



# LDFLAGS

在 Makefile 中有这么一段代码


```Makefile
 ifneq ($(CONFIG_debug),yes)
  LDFLAGS += -s
 endif
```

我在 Windows 下调试如果不去掉这个的话就不能打断点调试了，但是在 mac 下好像没有问题，研究下这个属性的设置。



# 作用

`LDFLAGS` 是用于编译过程中 **链接器** 阶段的环境变量。它包含传递给链接器（`ld` 或者 GCC 的链接阶段）的选项，用于指定如何处理目标文件、库、以及其他与链接相关的内容。

### 主要用途
- **指定库的路径**：`LDFLAGS` 可以用于告诉链接器到哪里去寻找静态库或共享库。例如：

  ```bash
  LDFLAGS="-L/usr/local/lib"
  ```

  这个命令告诉链接器在 `/usr/local/lib` 目录中查找库文件。

- **链接特定的库**：通过 `-l` 选项，链接器可以链接到某些特定的库。这个选项通常与 `LDFLAGS` 一起使用，例如：

  ```bash
  LDFLAGS="-lssl -lcrypto"
  ```

  这将链接 `ssl` 和 `crypto` 库。

- **指定输出格式**：你可以通过 `LDFLAGS` 向链接器传递控制输出文件格式的标志。例如，`-static` 标志用于静态链接所有库：

  ```bash
  LDFLAGS="-static"
  ```

- **其他链接器选项**：`LDFLAGS` 也可以包含其他与链接有关的选项，比如：
  - `-s`：去掉符号表，减小可执行文件体积。
  - `-rpath`：为可执行文件设置运行时库搜索路径。
  - `-Wl,<option>`：传递特定的选项给链接器。例如，`-Wl,-rpath,/custom/lib` 告诉链接器在运行时查找 `/custom/lib` 路径中的库。

### 常见使用示例
假设你有一个源文件 `main.c`，并且你需要链接一个自定义的库 `mylib`，该库位于 `/usr/local/lib`，那么可以这样设置 `LDFLAGS`：

```bash
gcc -o main.o -c main.c
gcc -o main main.o -L/usr/local/lib -lmylib
```

在 Makefile 中，你可以设置 `LDFLAGS` 变量，这样在链接阶段自动应用这些选项：

```makefile
LDFLAGS = -L/usr/local/lib -lmylib

main: main.o
    gcc -o main main.o $(LDFLAGS)
```

### 总结
`LDFLAGS` 主要用于指定链接时的库路径、库文件、以及其他与链接器相关的选项。它通常出现在编译和链接过程中，特别是在构建复杂项目或使用 Makefile 时，`LDFLAGS` 是控制链接行为的关键变量。

# LDFLAGS += -s 会怎么样？为什么会导致无法调试打断点？




当你在 `LDFLAGS` 中添加 `-s` 选项时，链接器会在生成的可执行文件中**删除符号表**。符号表包含了变量、函数名及其地址等信息，调试器（如 `gdb`）正是依赖这些符号信息来提供断点调试、变量查看等功能的。

### 具体行为
- **`-s` 选项**：告诉链接器在生成的可执行文件中删除符号信息，以减小文件的大小。符号信息包括：
  - 调试符号（例如函数名、变量名等）
  - 断点所需的代码地址映射
  - 调试信息如行号等

这就是为什么当你使用 `-s` 选项时，虽然程序可以正常编译和运行，但调试器无法使用调试功能，因为调试器无法找到相关的符号信息，也无法将代码与源文件行号正确对应。

### 为什么无法调试？
- 当你尝试在一个被 `-s` 处理过的可执行文件中使用 `gdb` 或其他调试器时，由于符号表被删除，调试器无法知道可执行文件中的哪个机器代码对应源代码中的哪个函数或行。这使得你无法设置断点，也无法查看变量、调用栈等调试信息。
- 即使你在编译时加了 `-g` 选项（生成调试信息），但由于在链接时使用了 `-s`，最终生成的可执行文件依然没有符号信息，导致调试功能失效。

### 解决方案
如果你需要调试功能，请不要在 `LDFLAGS` 中使用 `-s` 选项。可以移除 `-s`，或仅在发布时使用它，而在开发和调试阶段不要启用。

示例：

```bash
LDFLAGS += -L/usr/local/lib -lmylib  # 不加 -s
```

如果你确实想生成一个较小的可执行文件，但仍希望保留调试符号，你可以使用 `-g` 生成调试信息，而在需要时单独保留符号文件（使用 `strip --strip-debug` 只移除调试符号），这样可以在需要调试时加载外部符号文件。


