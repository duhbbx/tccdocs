# 2.1 main 函数的 argc 和 argv


在 C 语言的 `main` 函数中，`argc` 和 `argv` 是用于获取命令行参数的两个重要参数，它们通常由操作系统提供，当程序启动时，它们会携带用户在命令行中输入的参数。

## `argc` 和 `argv` 的来源

1. **操作系统传递**：当用户在命令行中执行一个程序时，操作系统会将用户输入的命令和参数解析，然后传递给程序的 `main` 函数。具体来说，`argc` 和 `argv` 是由操作系统传递给程序的启动函数，并由它们传递给 `main` 函数。
   - **`argc`**：表示传递给程序的命令行参数的个数。
   - **`argv`**：是一个字符串数组，其中每个元素是一个用户在命令行中输入的参数。

2. **命令行**：用户在命令行中执行程序时提供了这些参数。比如：

   ```bash
   ./my_program arg1 arg2
   ```

   - `argv[0]`：`"./my_program"`，是程序的名称或路径。
   - `argv[1]`：`"arg1"`，是用户输入的第一个参数。
   - `argv[2]`：`"arg2"`，是用户输入的第二个参数。
   - **`argc`**：此时的值为 3，因为命令行总共提供了 3 个字符串：程序名称、`arg1` 和 `arg2`。

## `argc` 和 `argv` 的含义

1. **`argc`**：
   - 全称是 **Argument Count**，表示传递给程序的参数个数，包括程序本身。
   - 例如，对于命令 `./my_program arg1 arg2`，`argc` 的值是 3。
   - 如果没有提供参数，只执行程序本身，`argc` 的值是 1（因为只包含程序名称本身）。

2. **`argv`**：
   - 全称是 **Argument Vector**，是一个字符串数组，每个元素代表一个命令行参数。
   - `argv[0]` 通常是程序的名称或路径，`argv[1]`、`argv[2]` 等是用户提供的参数。

## `argc` 和 `argv` 的用法

在 C 语言的 `main` 函数中，`argc` 和 `argv` 常用于处理用户在命令行中传递的参数，特别是编译器、命令行工具等程序。程序可以根据这些参数调整执行流程，比如编译、运行不同的任务或打开特定的文件。

### 示例：`argc` 和 `argv` 的使用

```c
#include <stdio.h>

int main(int argc, char *argv[]) {
    printf("argc = %d\n", argc);

    for (int i = 0; i < argc; i++) {
        printf("argv[%d] = %s\n", i, argv[i]);
    }

    return 0;
}
```

### 运行结果：

当你在命令行中运行程序 `./my_program arg1 arg2` 时，输出结果将是：

```bash
argc = 3
argv[0] = ./my_program
argv[1] = arg1
argv[2] = arg2
```

- **`argc`**：告诉程序有 3 个参数。
- **`argv`**：存储了程序名称和传递的两个参数。

## 进一步分析：`main` 函数中的 `argc` 和 `argv` 在你的代码中的使用

在你的代码中，`main` 函数的签名如下：

```c
int main(int argc0, char **argv0)
```

- 这里 `argc0` 和 `argv0` 是从操作系统传递给 `main` 函数的原始命令行参数。
- 这些参数是用户在命令行中调用 `TCC` 编译器时传递的，比如用户输入 `./tcc -o output hello.c`，`argc0` 是参数的数量（4），`argv0` 是包含这些字符串的数组。

在 `main` 函数中：

```c
argc = argc0;
argv = argv0;
```

- 这将 `argc0` 和 `argv0` 赋值给本地变量 `argc` 和 `argv`，以便在函数的后续部分使用这些参数。这样做通常是为了简化使用，并且在需要时可以通过改变 `argc` 和 `argv` 的值，达到不同的效果。

## 你代码中的 `argc` 和 `argv` 的实际用途

1. **传递给 `tcc_parse_args()`**：
   
   ```c
   opt = tcc_parse_args(s, &argc, &argv, 1);
   ```

   `tcc_parse_args` 是 `TinyCC` 中一个用于解析命令行参数的函数。它接收 `argc` 和 `argv`，并返回解析后的选项。这是命令行工具的核心功能，决定了程序根据用户输入的命令行参数执行什么操作。

2. **执行编译和其他工具任务**：
   
   根据用户输入的参数，`TCC` 会执行不同的任务，比如编译、链接、生成预处理文件等：
   
   ```c
   if (opt == OPT_HELP) {
       fputs(help, stdout);
       return 0;
   }
   ```

   如果用户输入了 `tcc --help`，程序会检测到 `OPT_HELP`，然后输出帮助信息。

3. **在编译过程中传递**：
   
   一些命令行参数，比如源文件路径或输出文件路径，会通过 `argc` 和 `argv` 被传递给编译器的其他部分，执行相应的文件操作或编译任务。

## 谁给的参数？

- **操作系统**：当用户在命令行中运行程序时，操作系统会将用户输入的命令行参数解析，并传递给程序的 `main` 函数。
  - 在 Linux、macOS 和 Windows 等操作系统中，当用户在终端或命令提示符下运行命令时，操作系统会捕获用户输入，并通过 `argc` 和 `argv` 传递给程序。
  - 比如，在 Linux 上运行 `./tcc -o output hello.c`，操作系统会将 `argc = 4` 和 `argv = {"./tcc", "-o", "output", "hello.c"}` 传递给 `main` 函数。

## 总结

- **`argc`** 是命令行参数的数量。
- **`argv`** 是一个包含命令行参数的数组，每个参数都是一个字符串。
- 这些参数由操作系统传递，当用户通过命令行运行程序时，操作系统捕获用户的输入并将其传递给 `main` 函数。
- 在你的代码中，`argc0` 和 `argv0` 是系统传递的参数，它们被赋值给局部变量 `argc` 和 `argv`，并在编译器的初始化、参数解析、文件处理等过程中使用。